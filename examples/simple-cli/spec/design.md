# Design Document - Todo CLI\n\n## Overview\n\nThe Todo CLI is a simple, efficient command-line task management application built with Node.js. It uses a file-based storage system and provides a clean, intuitive interface for managing daily tasks.\n\n**Design Philosophy:** Keep it simple, fast, and reliable  \n**Target Architecture:** Single-process CLI application  \n**Key Design Decisions:** File-based storage for simplicity, JSON format for data portability\n\n## Architecture\n\n### High-Level Architecture\n\n```mermaid\ngraph TB\n    A[User] --> B[CLI Interface]\n    B --> C[Command Parser]\n    C --> D[Task Manager]\n    D --> E[File Storage]\n    E --> F[JSON Data File]\n    \n    subgraph \"Core Components\"\n        C\n        D\n        E\n    end\n```\n\n### System Components\n\n#### Component 1: CLI Interface\n\n**Purpose:** Handle user input and display output  \n**Responsibilities:**\n- Parse command line arguments\n- Display formatted output\n- Handle user interactions\n- Show help messages\n\n**Interfaces:**\n- Command line arguments (input)\n- Console output (output)\n- Exit codes (output)\n\n#### Component 2: Command Parser\n\n**Purpose:** Interpret user commands and route to appropriate handlers  \n**Responsibilities:**\n- Validate command syntax\n- Extract command parameters\n- Route to appropriate handlers\n- Handle command errors\n\n**Interfaces:**\n- Raw command input\n- Parsed command objects\n- Validation errors\n\n#### Component 3: Task Manager\n\n**Purpose:** Core business logic for task operations  \n**Responsibilities:**\n- Create new tasks\n- Update task status\n- Delete tasks\n- Generate statistics\n\n**Interfaces:**\n- Task operations (CRUD)\n- Task validation\n- Business rule enforcement\n\n#### Component 4: File Storage\n\n**Purpose:** Persist task data to file system  \n**Responsibilities:**\n- Read task data from file\n- Write task data to file\n- Handle file system errors\n- Backup data\n\n**Interfaces:**\n- File system operations\n- JSON serialization\n- Error handling\n\n### Technology Stack\n\n- **Runtime:** Node.js 18+\n- **Language:** JavaScript (ES6+)\n- **Data Format:** JSON\n- **Storage:** Local file system\n- **CLI Framework:** Commander.js\n- **Testing:** Jest\n- **Packaging:** npm\n\n## Core Principles\n\n1. **Simplicity:** Minimal dependencies and straightforward architecture\n2. **Performance:** Fast startup and response times\n3. **Reliability:** Robust error handling and data persistence\n4. **Usability:** Intuitive commands following Unix conventions\n\n## Data Design\n\n### Data Models\n\n#### Task Model\n\n```javascript\ninterface Task {\n  id: number;\n  description: string;\n  status: 'pending' | 'completed';\n  createdAt: Date;\n  completedAt?: Date;\n}\n```\n\n**Validation Rules:**\n- `id`: Auto-generated, unique, sequential\n- `description`: Non-empty string, max 500 characters\n- `status`: Must be 'pending' or 'completed'\n- `createdAt`: Auto-generated timestamp\n- `completedAt`: Set when task is marked complete\n\n#### Storage Schema\n\n```json\n{\n  \"version\": \"1.0\",\n  \"lastId\": 5,\n  \"tasks\": [\n    {\n      \"id\": 1,\n      \"description\": \"Write project documentation\",\n      \"status\": \"completed\",\n      \"createdAt\": \"2024-01-01T10:00:00Z\",\n      \"completedAt\": \"2024-01-01T14:30:00Z\"\n    },\n    {\n      \"id\": 2,\n      \"description\": \"Review pull requests\",\n      \"status\": \"pending\",\n      \"createdAt\": \"2024-01-01T11:00:00Z\"\n    }\n  ]\n}\n```\n\n### File Storage Strategy\n\n**Storage Location:** `~/.todo-cli/tasks.json`  \n**Backup Strategy:** Create `tasks.json.bak` before each write operation  \n**Concurrent Access:** Single-user, no locking needed\n\n## Command Design\n\n### Command Structure\n\n**Base Command:** `todo`  \n**Subcommands:** `add`, `list`, `complete`, `remove`, `stats`, `help`\n\n### Command Specifications\n\n#### `todo add <description>`\n\n**Purpose:** Add a new task\n\n**Usage:**\n```bash\ntodo add \"Complete project documentation\"\ntodo add \"Review pull requests\"\n```\n\n**Implementation:**\n```javascript\nfunction addTask(description) {\n  // Validate input\n  if (!description || description.trim().length === 0) {\n    throw new Error('Task description cannot be empty');\n  }\n  \n  if (description.length > 500) {\n    throw new Error('Task description too long (max 500 characters)');\n  }\n  \n  // Create task\n  const task = {\n    id: generateNextId(),\n    description: description.trim(),\n    status: 'pending',\n    createdAt: new Date().toISOString()\n  };\n  \n  // Save task\n  storage.addTask(task);\n  \n  // Display confirmation\n  console.log(`Task added: [${task.id}] ${task.description}`);\n}\n```\n\n#### `todo list [options]`\n\n**Purpose:** Display tasks\n\n**Options:**\n- `--status <pending|completed>`: Filter by status\n- `--format <table|json>`: Output format\n\n**Usage:**\n```bash\ntodo list\ntodo list --status pending\ntodo list --status completed\n```\n\n**Implementation:**\n```javascript\nfunction listTasks(options = {}) {\n  const tasks = storage.getTasks();\n  \n  // Filter by status if specified\n  let filteredTasks = tasks;\n  if (options.status) {\n    filteredTasks = tasks.filter(task => task.status === options.status);\n  }\n  \n  // Sort by creation date (newest first)\n  filteredTasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\n  \n  // Display results\n  if (filteredTasks.length === 0) {\n    console.log('No tasks found');\n    return;\n  }\n  \n  filteredTasks.forEach(task => {\n    const statusIcon = task.status === 'completed' ? '[âœ“]' : '[ ]';\n    console.log(`${statusIcon} [${task.id}] ${task.description}`);\n  });\n}\n```\n\n#### `todo complete <task-id>`\n\n**Purpose:** Mark task as complete\n\n**Usage:**\n```bash\ntodo complete 1\ntodo complete 3\n```\n\n**Implementation:**\n```javascript\nfunction completeTask(taskId) {\n  const id = parseInt(taskId);\n  \n  if (isNaN(id)) {\n    throw new Error('Invalid task ID');\n  }\n  \n  const task = storage.getTask(id);\n  \n  if (!task) {\n    throw new Error('Task not found');\n  }\n  \n  if (task.status === 'completed') {\n    console.log('Task already completed');\n    return;\n  }\n  \n  // Update task\n  task.status = 'completed';\n  task.completedAt = new Date().toISOString();\n  \n  storage.updateTask(task);\n  \n  console.log(`Task completed: [${task.id}] ${task.description}`);\n}\n```\n\n#### `todo remove <task-id>`\n\n**Purpose:** Delete a task\n\n**Usage:**\n```bash\ntodo remove 1\n```\n\n**Implementation:**\n```javascript\nfunction removeTask(taskId) {\n  const id = parseInt(taskId);\n  \n  if (isNaN(id)) {\n    throw new Error('Invalid task ID');\n  }\n  \n  const task = storage.getTask(id);\n  \n  if (!task) {\n    throw new Error('Task not found');\n  }\n  \n  // Confirm deletion\n  const confirmed = confirm(`Delete task: ${task.description}? (y/N)`);\n  \n  if (!confirmed) {\n    console.log('Deletion cancelled');\n    return;\n  }\n  \n  storage.removeTask(id);\n  \n  console.log(`Task removed: [${task.id}] ${task.description}`);\n}\n```\n\n#### `todo stats`\n\n**Purpose:** Display task statistics\n\n**Usage:**\n```bash\ntodo stats\n```\n\n**Implementation:**\n```javascript\nfunction showStats() {\n  const tasks = storage.getTasks();\n  \n  if (tasks.length === 0) {\n    console.log('No tasks to analyze');\n    return;\n  }\n  \n  const total = tasks.length;\n  const completed = tasks.filter(task => task.status === 'completed').length;\n  const pending = total - completed;\n  const completionRate = Math.round((completed / total) * 100);\n  \n  console.log('Task Statistics:');\n  console.log(`Total tasks: ${total}`);\n  console.log(`Completed: ${completed}`);\n  console.log(`Pending: ${pending}`);\n  console.log(`Completion rate: ${completionRate}%`);\n}\n```\n\n## Error Handling\n\n### Error Types\n\n1. **Validation Errors:** Invalid input parameters\n2. **Not Found Errors:** Task ID doesn't exist\n3. **File System Errors:** Cannot read/write data file\n4. **Permission Errors:** No access to storage directory\n\n### Error Response Format\n\n```javascript\nclass TodoError extends Error {\n  constructor(message, code = 'GENERAL_ERROR') {\n    super(message);\n    this.name = 'TodoError';\n    this.code = code;\n  }\n}\n\n// Usage\nif (!task) {\n  throw new TodoError('Task not found', 'TASK_NOT_FOUND');\n}\n```\n\n### Error Handling Strategy\n\n```javascript\nfunction handleError(error) {\n  if (error instanceof TodoError) {\n    console.error(`Error: ${error.message}`);\n    process.exit(1);\n  } else {\n    console.error('An unexpected error occurred:', error.message);\n    process.exit(2);\n  }\n}\n```\n\n## Testing Strategy\n\n### Unit Testing\n\n**Framework:** Jest  \n**Coverage Target:** 90%+  \n**Test Structure:**\n\n```javascript\n// test/taskManager.test.js\ndescribe('TaskManager', () => {\n  let taskManager;\n  let mockStorage;\n  \n  beforeEach(() => {\n    mockStorage = {\n      getTasks: jest.fn(),\n      addTask: jest.fn(),\n      updateTask: jest.fn(),\n      removeTask: jest.fn()\n    };\n    taskManager = new TaskManager(mockStorage);\n  });\n  \n  describe('addTask', () => {\n    it('should create task with valid description', () => {\n      const description = 'Test task';\n      taskManager.addTask(description);\n      \n      expect(mockStorage.addTask).toHaveBeenCalledWith(\n        expect.objectContaining({\n          description: 'Test task',\n          status: 'pending',\n          id: expect.any(Number)\n        })\n      );\n    });\n    \n    it('should throw error for empty description', () => {\n      expect(() => {\n        taskManager.addTask('');\n      }).toThrow('Task description cannot be empty');\n    });\n  });\n});\n```\n\n### Integration Testing\n\n**Test File Operations:**\n```javascript\n// test/integration/storage.test.js\ndescribe('Storage Integration', () => {\n  let tempDir;\n  let storage;\n  \n  beforeEach(() => {\n    tempDir = fs.mkdtempSync(path.join(os.tmpdir(), 'todo-test-'));\n    storage = new FileStorage(path.join(tempDir, 'tasks.json'));\n  });\n  \n  afterEach(() => {\n    fs.rmSync(tempDir, { recursive: true, force: true });\n  });\n  \n  it('should persist tasks between sessions', () => {\n    const task = { id: 1, description: 'Test', status: 'pending' };\n    storage.addTask(task);\n    \n    // Create new storage instance\n    const newStorage = new FileStorage(path.join(tempDir, 'tasks.json'));\n    const tasks = newStorage.getTasks();\n    \n    expect(tasks).toHaveLength(1);\n    expect(tasks[0]).toEqual(task);\n  });\n});\n```\n\n## Deployment Architecture\n\n### Package Structure\n\n```\ntodo-cli/\nâ”œâ”€â”€ package.json\nâ”œâ”€â”€ README.md\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ index.js\nâ”‚   â”œâ”€â”€ cli.js\nâ”‚   â”œâ”€â”€ taskManager.js\nâ”‚   â””â”€â”€ storage.js\nâ”œâ”€â”€ test/\nâ”‚   â”œâ”€â”€ unit/\nâ”‚   â””â”€â”€ integration/\nâ””â”€â”€ docs/\n    â””â”€â”€ usage.md\n```\n\n### Installation\n\n**Global Installation:**\n```bash\nnpm install -g todo-cli\n```\n\n**Local Installation:**\n```bash\nnpm install todo-cli\nnpx todo-cli\n```\n\n### Configuration\n\n**Environment Variables:**\n- `TODO_CLI_DATA_DIR`: Custom data directory (default: `~/.todo-cli`)\n- `TODO_CLI_BACKUP_COUNT`: Number of backups to keep (default: 5)\n\n**Config File:** `~/.todo-cli/config.json`\n```json\n{\n  \"dateFormat\": \"YYYY-MM-DD\",\n  \"colorOutput\": true,\n  \"maxTasksDisplay\": 50\n}\n```\n\n## Performance Considerations\n\n### Optimization Strategies\n\n1. **Lazy Loading:** Load tasks only when needed\n2. **Caching:** Keep tasks in memory during command execution\n3. **Efficient Serialization:** Use streaming for large task lists\n4. **Minimal Dependencies:** Keep package size small\n\n### Performance Targets\n\n- **Startup Time:** < 50ms\n- **Command Response:** < 100ms for up to 1000 tasks\n- **Memory Usage:** < 50MB for 10,000 tasks\n- **File Size:** < 1MB for 10,000 tasks\n\n## Security Considerations\n\n### Data Protection\n\n- Task data stored in user's home directory\n- File permissions set to user-only access (600)\n- No network communication required\n- No sensitive data handling\n\n### Input Validation\n\n- Sanitize all user input\n- Validate command parameters\n- Prevent path traversal attacks\n- Limit input length\n\n## Future Enhancements\n\n### Phase 2 Features\n\n- Task priorities\n- Due dates\n- Task categories/tags\n- Search functionality\n- Export/import features\n\n### Phase 3 Features\n\n- Multiple task lists\n- Task templates\n- Recurring tasks\n- Integration with external tools\n\n---\n\n**Document Version:** 1.0  \n**Last Updated:** 2024-01-01  \n**Next Review:** 2024-02-01  \n**Approved By:** Development Team Lead